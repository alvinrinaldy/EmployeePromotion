sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/core/routing/History","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ColumnListItem","sap/m/Label","sap/m/SearchField","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,a,l,i,s,n,r,u){"use strict";return e.extend("ZAL.Promosi.controller.SelectEmployeePromotion",{handleRouteMatched:function(e){var t="App60336b1fade8e57e74bdb140";var o={};var a;if(this.sContext){a={path:"/"+this.sContext,parameters:o};this.getView().bindObject(a)}},_onButtonPress:function(e){var t=e.getSource();var o=this.getView().byId("idEmployeeID").getValue().substr(0,8);var a=this.getView().byId("idEmployeeID").getValue().substr(11);console.log(o,a);var l=sap.ui.core.UIComponent.getRouterFor(this);l.navTo("CreateNewPromotion",{EmployeeId:encodeURIComponent(o),EmployeeName:encodeURIComponent(a)})},doNavigate:function(e,t,o,a){var l=t?t.getPath():null;var i=t?t.getModel():null;var s;if(l!==null&&l!==""){if(l.substring(0,1)==="/"){l=l.substring(1)}s=l.split("(")[0]}var n;var r=this.sMasterContext?this.sMasterContext:l;if(s!==null){n=a||this.getOwnerComponent().getNavigationPropertyForNavigationWithContext(s,e)}if(n!==null&&n!==undefined){if(n===""){this.oRouter.navTo(e,{context:l,masterContext:r},false)}else{i.createBindingContext(n,t,null,function(t){if(t){l=t.getPath();if(l.substring(0,1)==="/"){l=l.substring(1)}}else{l="undefined"}if(l==="undefined"){this.oRouter.navTo(e)}else{this.oRouter.navTo(e,{context:l,masterContext:r},false)}}.bind(this))}}else{this.oRouter.navTo(e)}if(typeof o==="function"){o()}},onInit:function(){var e="/sap/opu/odata/sap/ZHCM_PROMOSI_SRV/";var o=new sap.ui.model.odata.v2.ODataModel(e);o.setDefaultCountMode(sap.ui.model.odata.CountMode.inline);this.getView().setModel(o,"odataSelectEmployee");this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getTarget("SelectEmployeePromotion").attachDisplay(jQuery.proxy(this.handleRouteMatched,this));this.getView().setModel(this.oProductsModel);this.oColModel=new a({cols:[{label:"Employee Id",template:"Pernr",width:"5rem"},{label:"Employee Name",template:"Cname"},{label:"Employee Last Name",template:"Nachn"},{label:"Personnel Area",template:"Werks"},{label:"Personnel Subarea",template:"Btrtl"},{label:"Employee Group",template:"Persg"},{label:"Employee Subgroup",template:"Persk"},{label:"Company Code",template:"Bukrs"},{label:"Cost Center",template:"Kostl"},{label:"Organizational Unit",template:"Orgeh"},{label:"Organizational Key",template:"Vdsk1"},{label:"Administrator Group",template:"Sbmod"},{label:"Time Administrator",template:"Sachz"}]});this.oProductsModel="";var l=this;var e="/sap/opu/odata/sap/ZHCM_PROMOSI_SRV/";var o=new sap.ui.model.odata.ODataModel(e);var i=[];o.read("/SelectEmployeeSet",{success:function(e){var t=e.results;console.log("Odata Results : ");console.log(t);var o={Employee:t};l.oProductsModel=new a(o)},error:function(e){t.error("No employee data found.")},filters:i});this.getView().setModel(this.oProductsModel)},handleValueHelpSelectEmployee:function(e){console.log("handleValueHelpSelectEmployee..");var t=this.oColModel.getData().cols;this._oBasicSearchField=new n({showSearchButton:false});this._oValueHelpDialog=sap.ui.xmlfragment("ZAL.Promosi.view.ValueHelpDialog.SelectEmployee",this);this.getView().addDependent(this._oValueHelpDialog);var o=this._oValueHelpDialog.getFilterBar();o.setFilterBarExpanded(false);o.setBasicSearch(this._oBasicSearchField);this._oValueHelpDialog.getTableAsync().then(function(e){e.setModel(this.oProductsModel);e.setModel(this.oColModel,"columns");if(e.bindRows){e.bindAggregation("rows","/Employee")}if(e.bindItems){e.bindAggregation("items","/Employee",function(){return new i({cells:t.map(function(e){return new s({text:"{"+e.template+"}"})})})})}this._oValueHelpDialog.update()}.bind(this));this._oValueHelpDialog.open()},onValueHelpOkPress:function(e,t){console.log(e.getSource()._oSelectedItems.items.undefined);this.employeeData=e.getSource()._oSelectedItems.items.undefined;var o=this.getView().byId("idEmployeeID");o.setValue(this.employeeData.Pernr+" - "+this.employeeData.Cname);this._oValueHelpDialog.close()},onValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onFilterBarSearch:function(e){console.log("this._oBasicSearchField : ");console.log(this._oBasicSearchField);var t=this._oBasicSearchField.getValue(),o=e.getParameter("selectionSet");var a=o.reduce(function(e,t){if(t.getValue()){e.push(new r({path:t.getName(),operator:u.Contains,value1:t.getValue()}))}return e},[]);a.push(new r({filters:[new r({path:"Pernr",operator:u.Contains,value1:t}),new r({path:"Cname",operator:u.Contains,value1:t}),new r({path:"Bukrs",operator:u.Contains,value1:t})],and:false}));this._filterTable(new r({filters:a,and:true}))},_filterTable:function(e){var t=this._oValueHelpDialog;t.getTableAsync().then(function(o){if(o.bindRows){o.getBinding("rows").filter(e)}if(o.bindItems){o.getBinding("items").filter(e)}t.update()})}})},true);